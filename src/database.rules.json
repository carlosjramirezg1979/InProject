
{
  "rules": {
    "rules_version": "2",
    "service": "cloud.firestore",
    "match": "/databases/{database}/documents" {
      "match": "/projectManagers/{userId}" {
        "allow read, update: if request.auth != null && request.auth.uid == userId;"
      }
      "match": "/companies/{companyId}" {
        "allow create: if request.auth != null;"
        "allow read: if request.auth != null && companyId in get(/databases/$(database)/documents/projectManagers/$(request.auth.uid)).data.companyIds;"
        "allow update, delete: if false;"
      }
      "match": "/projects/{projectId}" {
      	"allow create: if request.auth != null;"
        "allow read, update: if request.auth != null && request.resource.data.projectManagerId == request.auth.uid;"
        "allow delete: if false;"
      }
    }
  }
}
