
{
  "rules": {
    "rules_version": "2",
    "services": {
      "cloud.firestore": {
        "match": {
          "databases": {
            "{database}": {
              "documents": {
                "projectManagers": {
                  "{userId}": {
                    "allow": "read, update: if request.auth != null && request.auth.uid == userId;"
                  }
                },
                "companies": {
                  "{companyId}": {
                    "allow": "read: if request.auth != null && companyId in get(/databases/$(database)/documents/projectManagers/$(request.auth.uid)).data.companyIds; create: if request.auth != null; update, delete: if false;"
                  }
                },
                "projects": {
                  "{projectId}": {
                    "allow": "create: if request.auth != null; read, update: if request.auth != null && get(/databases/$(database)/documents/projects/$(projectId)).data.projectManagerId == request.auth.uid; delete: if false;"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
